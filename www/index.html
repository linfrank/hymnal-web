<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Hymnal</title>

    <!-- Bootstrap -->
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap theme -->
    <!-- <link href="css/bootstrap-theme.css" rel="stylesheet"> -->

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->

    <!-- hymnal css -->
    <link href="css/hymnal.css" rel="stylesheet">
    <!-- hymnal favicon -->
    <link rel="shortcut icon" href="images/favicon.png" />

  </head>
  <body>

    <div class="navbar navbar-default navbar-default-hymn">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle navbar-toggle-hymn" data-toggle="collapse" data-target=".navbar-responsive-collapse">
            <span class="icon-bar icon-bar-pr"></span>
            <span class="icon-bar icon-bar-pr"></span>
            <span class="icon-bar icon-bar-pr"></span>
          </button>
          <span class="navbar-brand">
            <span id="book-name">Hymns</span>&nbsp;
            <input id="number-search-input"
                   type="number"
                   placeholder="#"
                   onKeyup="if(event.keyCode == 13)loadHymnNumber()"
                   onKeydown="if(event.keyCode == 9)loadHymnNumber()" />
          </span>
        </div>
        <div class="navbar-collapse collapse navbar-responsive-collapse navbar-collapse-hymn nav-hymn">
          <ul class="nav navbar-nav navbar-right pull-right">
            <li><a href="#">Categories</a></li>
            <li><a href="#">About</a></li>
          </ul>
        </div>
      </div>
    </div>

    <div class="container" id="hymn-page">
      <div id="hymn-greeting">Hymns</div>
    </div>

  </div>

  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="js/jquery-1.11.1.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="js/bootstrap.min.js"></script>

  <!-- Smooth scroll -->
  <script src="js/jquery.easing.1.3.js"></script>
  <script src="js/jquery.scrollTo-1.4.11.min.js"></script>
  <script>
    $(function() {
      $("a[href^='#']").bind('click', 'ul li a', function(event) {
        // prevents flickering
        event.preventDefault();
        // smooth scroll
        $.scrollTo(event.target.hash, 750, {easing:'easeOutQuad',offset:-40});
        // hide collapsed navbar after clicking
        $(function() {
          $('.nav a').on('click', function(){
            if($('.navbar-toggle').css('display') !='none'){
              $(".navbar-toggle").trigger( "click" );
            }
          });
        });
      });
    });
  </script>

  <script src="js/hymnal.js"></script>

  <script>

    var hymnBase = 'data/LSM/English/';

    function loadHymn(id, doneFunc, errFunc){
      $.getJSON(hymnBase + id + '.json',function(data){
        // Update navbar
        updateNav(data);
        // Replace old page with new one
        $('#hymn-page').children().remove();
        $('#hymn-page').append($(makePage(data)));
      })
      .done(doneFunc)
      .fail(errFunc);
    }

    function loadHymnNumber(num){
      var needToggle = false;
      if (num === null || num === undefined){
        num = $('#number-search-input').val();
      }
      loadHymn(
        'LSM.English.' + num,
        function(){
          $('#number-search-input').val('').blur().attr('placeholder', num);
        },
        function(){
          console.log('hymn #' + num + ' not found!');
          $('#number-search-input').css('text-decoration','line-through');
        });
    }

    function init(){
      // Prevent keydown next and submission
      $(document).ready(function(){
        $(window).keydown(function(event){
          $('#number-search-input').css('text-decoration','none');
          if(event.keyCode == 13 || event.keyCode == 9){
            event.preventDefault();
            return false;
          }
        });
      });
      // Load default hymn
      loadHymnNumber(1);
    }

    $(init());

  </script>

</body>
</html>
